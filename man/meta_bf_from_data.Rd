% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/meta_bf_from_data.R
\name{meta_bf_from_data}
\alias{meta_bf_from_data}
\title{Meta-analytic Bayes Factors by Measurement (with optional subject overlap & per-dataset weights)}
\usage{
meta_bf_from_data(
  data,
  dataset_col = NULL,
  measurement_name_col,
  standard_scores_col,
  measurement_values_col,
  subject_id_col = NULL
)
}
\arguments{
\item{data}{A data frame containing at least the measurement names, standard scores, and measurement values.}

\item{dataset_col}{A string naming the column identifying datasets/studies. If \code{NULL} or missing in \code{data},
all rows are treated as belonging to a single dataset (a new column \code{"dataset_col"} is created with
value \code{"all_data"}), and a warning is emitted.}

\item{measurement_name_col}{A string naming the column with the measurement identifier (e.g., task/metric name).}

\item{standard_scores_col}{A string naming the column with the standard scores (often a binary 0/1 score).}

\item{measurement_values_col}{A string naming the column with the measurement values to be related to the standard scores.}

\item{subject_id_col}{Optional string naming the column with unique subject identifiers. If supplied, the function
will compute a subject-overlap matrix across measurements (counts of shared subjects across datasets).}
}
\value{
A list with three elements:
\describe{
\item{meta_results}{A data frame with one row per measurement containing:
\itemize{
\item \code{measurement}: Measurement identifier.
\item \code{combined_bayes_factor}: Meta-analytic Bayes factor computed from the combined t.
\item \code{log_combined_bayes_factor}: Base-2 logarithm of the Bayes factor.
\item \code{retrodiction_score}: Pearson correlation implied by the combined t and total sample size.
\item \code{sample_size}: Total sample size across datasets for the measurement.
\item \code{combined_t_statistic}: Weighted sum of per-dataset t-statistics.
}
}
\item{subject_overlap}{If \code{subject_id_col} is supplied, a square matrix whose \eqn{(i,j)} entry is the
\strong{count of shared subjects} between measurement \eqn{i} and \eqn{j} (NA if undefined).}
\item{weights}{A named list (one element per measurement). Each element is a data frame with columns:
\code{dataset}, \code{weight}, \code{t_statistic}, \code{sample_size}, and \code{sum_squares}, giving per-dataset inputs and weights.}
}
}
\description{
Computes \strong{meta-analytic Bayes Factors (BFs)} for each measurement across datasets by:
(i) extracting a per-dataset t-statistic and ancillary stats via \code{extract_stats()},
(ii) combining those t-statistics with weights from \code{compute_weights()},
and (iii) turning the combined t into a Bayes factor via \code{tstat2bf()}.
It also returns a retrodiction score (a Pearson correlation implied by the combined t via \code{tstat2rscore()}).
If \code{subject_id_col} is provided, the function additionally reports the \strong{count of shared subjects} between
measurement pairs (based on the datasetâ€“subject combinations), which can help assess the comparability of BFs.
}
\details{
This function relies on helper routines that must exist in your environment:
\code{extract_stats()}, \code{compute_weights()}, \code{tstat2bf()}, and \code{tstat2rscore()}.

For each measurement:
\itemize{
\item The function loops over datasets and calls \code{extract_stats(standard_scores, measurement_values, subject_ids)}
to obtain a per-dataset \code{t_statistic}, \code{sample_size}, and \code{sum_squares}.
\item It then obtains per-dataset weights via \code{compute_weights(t_statistics, sample_sizes, sum_squares)} and forms
a \strong{combined t-statistic} as the weighted sum \code{sum(weights * t_statistics)}.
\item The Bayes factor is computed by \code{tstat2bf(combined_t_statistic, sum(sample_sizes), g = sum(sample_sizes))}
(i.e., using total sample size for both the sample-size argument and the \code{g} hyperparameter).
\item The \strong{retrodiction score} (a Pearson correlation) is computed via
\code{tstat2rscore(combined_t_statistic, sum(sample_sizes))}.
}

When \code{subject_id_col} is provided, subjects are indexed by the pair \{dataset, subject\}; the returned
\code{subject_overlap} matrix reports the \strong{number of shared subjects} between each pair of measurements
(NA if undefined because a measurement has no subjects).
}
\examples{
\dontrun{
set.seed(1)

# Toy helper to fabricate two studies with two measurements (A,B) and a binary standard score
make_study <- function(id, n = 80) {
  subj <- data.frame(
    study_id       = id,
    subject_id     = 1:n,
    standard_score = rbinom(n, 1, 0.5)
  )
  # Each subject contributes both measurements; effects differ by measurement
  A <- transform(subj,
                 measurement_type = "A",
                 measurement_value = rnorm(n, mean = 0.8 * standard_score, sd = 1))
  B <- transform(subj,
                 measurement_type = "B",
                 measurement_value = rnorm(n, mean = 0.4 * standard_score, sd = 1))
  rbind(A, B)
}

all_studies <- rbind(make_study("S1", 80), make_study("S2", 100))

# Requires user-defined helpers: extract_stats(), compute_weights(), tstat2bf(), tstat2rscore()
out <- meta_bf_from_data(
  data = all_studies,
  dataset_col = "study_id",
  measurement_name_col = "measurement_type",
  standard_scores_col = "standard_score",
  measurement_values_col = "measurement_value",
  subject_id_col = "subject_id"
)

out$meta_results      # main summary table
out$subject_overlap   # shared-subject counts between measurements
out$weights$A         # per-dataset weights/inputs for measurement A
}
}
\seealso{
\code{\link{extract_stats}}, \code{\link{compute_weights}}, \code{\link{tstat2bf}}, \code{\link{tstat2rscore}}
}
